accelerator:
  displayName: Kubernetes Java Web App
  description: Tanzu Java Spring-Boot Web App, displaying kubernetes info.
  iconUrl: https://upload.wikimedia.org/wikipedia/labs/b/ba/Kubernetes-icon-color.svg
  tags:
  - Java
  - Kubernetes
  - Spring-Boot

  options: # a list of options
    
    - name: projectName
      label: Name
      description: Provide a name for your new project.
      dataType: string
      inputType: text
      required: true
      defaultValue: my-java-app
      validationRegex: "^[a-z0-9-]+$"
    
    # - name: namespace
    #   label: Namespace
    #   description: Application's namespace to deploy to.
    #   dataType: string
    #   inputType: text
    #   required: true
    #   defaultValue: apps
    #   validationRegex: "^[a-z0-9-]+$"

    # - name: greetingMessage
    #   label: Greeting Message
    #   description: Greeting message displayed by the Hello World app.
    #   dataType: string
    #   inputType: text
    #   required: true
    #   defaultValue: Welcome to TAP accelerator demo!

    # - name: greetingDescription
    #   label: Greeting Description
    #   description: Greeting message description displayed by the Hello World app.
    #   dataType: string
    #   inputType: text
    #   required: true
    #   defaultValue: by Cloud Native Applications team.

  imports:
    - name: template-workload-fragment
      expose:
        - name: namespace
        - name: greetingMessage
        - name: greetingDescription

    - name: template-catalog-info-fragment

    - name: jvm-version-fragment
      expose:
        - name: jvmVersion
    
    - name: java-rewrite-package-fragment
      expose: 
        - name: packageName

    - name: java-rename-app-fragment

    - name: enable-live-update-fragment
      expose: 
        - name: "*"

engine:
  merge:   
    # include all, exclude specifically handled files.  
    - include: ['*/**']
      exclude: ['Tiltfile', 'config/**', 'catalog/*.yaml', 'target/**', 'docs/**', '.vscode/**', "**/*.java", "pom.xml", "fragments"]
    
    - include: ["*/**.java"]
      chain:
        - type: InvokeFragment
          reference: java-rewrite-package-fragment
    
    - include: [config/**]
      chain:
        - type: InvokeFragment
          reference: template-workload-fragment
          let:
            - name: jvmVersion
              expression: "#jvmVersion"

    - include: ["catalog/*.yaml", "config/values.yaml"]
      # exclude: ["catalog/docs/**"]
      chain:
        type: InvokeFragment
        reference: template-catalog-info-fragment
        let: 
          - name: namespace
            expression: "#namespace" 

    - include: ["Tiltfile"]
      chain:
        - type: InvokeFragment
          reference: enable-live-update-fragment
          let:
          - name: namespace
            expression: "#namespace"
  
  onConflict: UseFirst