accelerator:
  displayName: Kubernetes Java Web App
  description: Tanzu Java Spring-Boot Web App, displaying kubernetes info.
  iconUrl: https://upload.wikimedia.org/wikipedia/labs/b/ba/Kubernetes-icon-color.svg
  tags:
  - Java
  - Kubernetes
  - Spring-Boot

  options: # a list of options
    - name: greetingMessage
      label: Greeting Message
      description: Greeting message displayed by the Hello World app.
      dataType: string
      inputType: text
      required: true
      defaultValue: Welcome to TAP accelerator demo!
    - name: greetingDescription
      label: Greeting Description
      description: Greeting message description displayed by the Hello World app.
      dataType: string
      inputType: text
      required: true
      defaultValue: by Cloud Native Applications team.
    
    - name: enableLiveUpdate
      label: Enable Live Update
      description: Enables Live Update & Live Debug features
      inputType: checkbox
      dataType: boolean
      required: true
      defaultValue: true

    - name: chooseCluster
      label: Choose Cluster
      description: Choose which clusters to auto-configure for the project, or specify a custom context of a specific cluster.
      inputType: select
      dataType: string
      choices:
      - text: "All Clusters"
        value: allClusters 
      - text: "Only Local Clusters"
        value: localClusters
      - text: "Specific Cluster"
        value: specificCluster
      defaultValue: allClusters
      dependsOn:
        name: enableLiveUpdate
      required: true

    - name: clusterContext
      label: Cluster Context
      description: Specify the cluster's context
      dataType: string
      inputType: text
      required: true
      defaultValue: ""
      dependsOn: 
        name: chooseCluster
        value: specificCluster

engine:
  merge:     
    # - include: ['src/**', 'pom.xml', 'Tiltfile', '.giignore', '.tanzuignore', 'LICENSE', 'mvnw', 'mvnw.cmd', '.mvn/**', 'README.md', "catalog/docs/**"]
    - include: ['*/**']
      exclude: ['Tiltfile', 'config/**', 'catalog/*.yaml', 'target/**', 'docs/**', '.vscode/**']
    
    - include: ["config/**", "catalog/*.yaml"]
      exclude: ["catalog/docs/**"]
      chain:
        - type: ReplaceText
          substitutions:
            - text: "default-greeting-message"
              with: "#greetingMessage"
            - text: "default-greeting-description"
              with: "#greetingDescription"
            - text: "default-project-name"
              with: "#projectName"
        - type: YTT
    
    - include: ['Tiltfile']
      condition: "#chooseCluster == 'allClusters'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: "default-project-name"
              with: "#projectName"
            - text: "k8s-context"
              with: "'k8s_context()'"
    
    # - include: ['Tiltfile']
    #   condition: "#chooseCluster == 'localClusters'"
    #   chain:
    #     - type: ReplaceText
    #       substitutions:
    #         - text: "<project-name>"
    #           with: "#projectName"
    #         - text: "allow_k8s_contexts('<k8s-context>')"
    #           with: " "
    
    # - include: ['Tiltfile']
    #   condition: "#chooseCluster == 'specificCluster'"
    #   chain:
    #     - type: ReplaceText
    #       substitutions:
    #         - text: "<project-name>"
    #           with: "#projectName"
    #         - text: "<k8s-context>"
    #           with: "#chooseCluster"
  # onConflict: UseFirst
    

